# Updating Your Service Layer

In an earlier learning path, you wrote an `addGuestbook` service method in
`GuestbookLocalServiceImpl`. The `addGuestbook` method of `GuestbookPortlet`
calls this service method. You can reuse the `addGuestbook` method of
`GuestbookLocalServiceImpl` by calling it from `GuestbookAdminPortlet` too.
However, you need to add a new service method for updating a guestbook and a new
service method for deleting a guestbook. You also need to add a service method
that returns the number of guestbooks in a site. You'll use this service method
when you're implementing your user interface since you'll use a Liferay taglib
construct called Search Container. Your search container needs to know how many
guestbooks to display.

## Adding Guestbook Service Methods

Remember that when working with Service Builder, the `*Impl` classes are your
extension points. After you add or remove a method from an `*Impl` class or
change a method signature of an `*Impl` class, you must run Service Builder.
Service Builder updates the affected interfaces and any other affected generated
code.

Use the following steps to add the required Guestbook service methods:

1. Open `GuestbookLocalServiceImpl.java` and add the following method for
   updating a guestbook:

        public Guestbook updateGuestbook(long guestbookId, String name,
                        ServiceContext serviceContext) throws PortalException,
                        SystemException {

                Date now = new Date();

                validate(name);

                Guestbook guestbook = getGuestbook(guestbookId);

                guestbook.setModifiedDate(serviceContext.getModifiedDate(now));
                guestbook.setName(name);
                guestbook.setExpandoBridgeAttributes(serviceContext);

                guestbookPersistence.update(guestbook);

                resourceLocalService.updateResources(serviceContext.getCompanyId(),
                                serviceContext.getScopeGroupId(), name, guestbookId,
                                serviceContext.getGroupPermissions(),
                                serviceContext.getGuestPermissions());

                return guestbook;
        }

2. Next, add the following method for deleting a guestbook:

        public Guestbook deleteGuestbook(long guestbookId,
                        ServiceContext serviceContext) throws PortalException,
                        SystemException {

                Guestbook guestbook = getGuestbook(guestbookId);

                List<Entry> entries = EntryLocalServiceUtil.getEntries(
                                serviceContext.getScopeGroupId(), guestbookId);

                for (Entry entry : entries) {
                        EntryLocalServiceUtil.deleteEntry(entry.getEntryId(),
                                        serviceContext);
                }

                resourceLocalService.deleteResource(serviceContext.getCompanyId(),
                                Guestbook.class.getName(), ResourceConstants.SCOPE_INDIVIDUAL,
                                guestbookId);

                guestbook = deleteGuestbook(guestbook);

                return guestbook;
        }

3. Finally, add the following method for returning the number of guestbooks in a
   site:

        public int getGuestbooksCount(long groupId) throws SystemException {
                return guestbookPersistence.countByGroupId(groupId);
        }

    `guestbookPersistence`, like `resourceLocalService`, is a Spring bean
    declared in `GuestbookLocalServiceImpl`'s parent class,
    `GuestbookLocalServiceBaseImpl`. The `guestbookPersistence` implementation
    is `GuestbookPersistenceImpl`, which is one of the classes generated by
    Service Builder.

These are all the additions you need to make to the Guestbook service. Save
`GuestbookLocalServiceImpl.java` and run Service Builder.

Now that you've finished updating the service layer, it's time to work on the
Guestbook Admin portlet itself.

