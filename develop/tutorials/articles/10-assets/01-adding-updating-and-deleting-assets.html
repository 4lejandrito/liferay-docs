<h1>Adding, Updating, and Deleting Assets for Custom Entities</h1><p>To use Liferay&rsquo;s asset framework with an entity, you must inform the asset framework about each entity instance you create, modify, and delete. In this sense, it&rsquo;s similar to informing Liferay&rsquo;s permissions framework about a new resource. All you have to do is invoke a method of the asset framework that associates an <code>AssetEntry</code> with the entity so Liferay can keep track of the entity as an asset. When it&rsquo;s time to update the entity, you update the asset at the same time. <!--To see how to asset-enable entities in a working example
portlet, visit the Learning
Path [Asset Enabling Custom Entities](/develop/learning-paths/mvc/-/knowledge_base/6-2/asset-enabling-custom-entities).
--></p><p>To leverage assets, you must also implement indexers for your portlet&rsquo;s entities. Liferay&rsquo;s asset framework uses indexers to manage assets. <!--  For
instructions on
creating an indexer in a working example portlet, see the learning path [Enabling Search and Indexing](/develop/learning-paths/mvc/-/knowledge_base/6-2/enabling-search-and-indexing).
--></p><p>This tutorial shows you how to enable assets for your custom entities and implement indexes for them. It&rsquo;s time to get started! </p><a id="preparing-your-project-for-the-asset-framework"></a><h2>Preparing Your Project for the Asset Framework</h2><p>In your project&rsquo;s <code>service.xml</code> file, add an asset entry entity reference for your custom entity. Add the following <code>reference</code> tag before your custom entity&rsquo;s closing <code>&lt;/entity&gt;</code> tag.</p>
<pre><code>&lt;reference package-path=&quot;com.liferay.portlet.asset&quot; entity=&quot;AssetEntry&quot; /&gt;
</code></pre><p>Then <a href="/develop/tutorials/-/knowledge_base/7-0/running-service-builder-and-understanding-the-generated-code">run</a> Service Builder.</p><p>Now you&rsquo;re ready to implement adding and updating assets!</p><a id="adding-and-updating-assets"></a><h2>Adding and Updating Assets</h2><p>Your <code>-LocalServiceImpl</code> Java class inherits from its parent base class an <code>AssetEntryLocalService</code> instance; it&rsquo;s assigned to the variable <code>assetEntryLocalService</code>. To add your custom entity as a Liferay asset, you must invoke the <code>assetEntryLocalService</code>&rsquo;s <code>updateEntry</code> method. </p><p>Here&rsquo;s what the <a href="https://docs.liferay.com/portal/7.0/javadocs/portal-impl/com/liferay/portlet/asset/service/impl/AssetEntryLocalServiceImpl.html"><code>updateEntry</code></a> method&rsquo;s signature looks like:</p>
<pre><code>AssetEntry updateEntry(
    long userId, long groupId, Date createDate, Date modifiedDate,
    String className, long classPK, String classUuid, long classTypeId,
    long[] categoryIds, String[] tagNames, boolean listable,
    boolean visible, Date startDate, Date endDate, Date publishDate,
    Date expirationDate, String mimeType, String title,
    String description, String summary, String url, String layoutUuid,
    int height, int width, Double priority)
throws PortalException
</code></pre><p>Here are descriptions of each of the <code>updateEntry</code> method&rsquo;s parameters: </p>
<ul>
  <li><code>userId</code>: identifies the user updating the content.</li>
  <li><code>groupId</code>: identifies the scope of the created content. If your content doesn&rsquo;t support scopes (extremely rare), pass <code>0</code> as the value.</li>
  <li><code>createDate</code>: the date the entity was created.</li>
  <li><code>modifiedDate</code>: the date of this change to the entity.</li>
  <li><code>className</code>: identifies the entity&rsquo;s class. The recommended convention is to use the name of the Java class that represents your content type. For example, you can pass in the value returned from <code>[YourClassName].class.getName()</code>.</li>
  <li><code>classPK</code>: identifies the specific entity instance, distinguishing it from other instances of the same type. It&rsquo;s usually the primary key of the table where the entity is stored.</li>
  <li><code>classUuid</code>: serves as a secondary identifier that&rsquo;s guaranteed to be universally unique. It correlates entity instances across scopes. It&rsquo;s especially useful if your content is exported and imported across separate portals.</li>
  <li><code>classTypeId</code>: identifies the particular variation of this class, if it has any variations. Otherwise, use <code>0</code>.</li>
  <li><code>categoryIds</code>: represent the categories selected for the entity. The asset framework stores them for you.</li>
  <li><code>tagNames</code>: represent the tags selected for the entity. The asset framework stores them for you.</li>
  <li><code>listable</code>: specifies whether the entity can be shown in dynamic lists of  content (such as asset publisher configured dynamically).</li>
  <li><code>visible</code>: specifies whether the entity is approved.</li>
  <li><code>startDate</code>: the entity&rsquo;s publish date. You can use it to specify when an  Asset Publisher should show the entity&rsquo;s content.</li>
  <li><code>endDate</code>: the date the entity is taken down. You can use it to specify  when an Asset Publisher should stop showing the entity&rsquo;s content.</li>
  <li><code>publishDate</code>: the date the entity will start to be shown.</li>
  <li><code>expirationDate</code>: the date the entity will no longer be shown.</li>
  <li><code>mimetype</code>: the Multi-Purpose Internet Mail Extensions type, such as <a href="http://docs.liferay.com/portal/6.2/javadocs-all/com/liferay/portal/kernel/util/ContentTypes.html#TEXT_HTML">ContentTypes.TEXT_HTML</a>, used for the content.</li>
  <li><code>title</code>: the entity&rsquo;s name.</li>
  <li><code>description</code>: a <code>String</code>-based textual description of the entity.</li>
  <li><code>summary</code>: a shortened or truncated sample of the entity&rsquo;s content.</li>
  <li><code>url</code>: a URL to optionally associate with the entity.</li>
  <li><code>layoutUuid</code>: the universally unique ID of the layout of the entry&rsquo;s default display page.</li>
  <li><code>height</code>: this can be set to <code>0</code>.</li>
  <li><code>width</code>: this can be set to <code>0</code>.</li>
  <li><code>priority</code>: specifies how the entity is ranked among peer entity instances. Low numbers take priority over higher numbers.</li>
</ul><p>The following code from Liferay&rsquo;s Wiki application&rsquo;s <a href="https://github.com/liferay/liferay-portal/blob/master/modules/apps/collaboration/wiki/wiki-service/src/main/java/com/liferay/wiki/service/impl/WikiPageLocalServiceImpl.java">-LocalServiceImpl</a> Java class demonstrates invoking the <code>updateEntry</code> method on the wiki page entity called <code>WikiPage</code>. In your <code>add-</code> method, you could invoke <code>updateEntry</code> after adding your entity&rsquo;s resources. Likewise, in your <code>update-</code> method, you could invoke <code>updateEntry</code> after calling the <code>super.update-</code> method. The code below is called in the <code>WikiPageLocalServiceImpl</code> class&rsquo;s <code>updateStatus(...)</code> method.</p>
<pre><code>AssetEntry assetEntry = assetEntryLocalService.updateEntry(
    userId, page.getGroupId(), page.getCreateDate(),
    page.getModifiedDate(), WikiPage.class.getName(),
    page.getResourcePrimKey(), page.getUuid(), 0,
    assetCategoryIds, assetTagNames, true, true, null, null,
    page.getCreateDate(), null, ContentTypes.TEXT_HTML,
    page.getTitle(), null, null, null, null, 0, 0, null);

Indexer&lt;JournalArticle&gt; indexer = IndexerRegistryUtil.nullSafeGetIndexer(
    WikiPage.class);

indexer.reindex(page);
</code></pre><p>Immediately after invoking the <code>updateEntry</code> method, you must update the respective asset and index the entity instance. The above code calls the indexer to index (or re-index, if updating) the entity. It&rsquo;s that easy to update assets and indexes.</p><div class="sidebar"><div class="sidebar-image"></div><div class="sidebar-text"><p><strong>Tip:</strong> The current user&rsquo;s ID and the scope group ID are commonly made available in service context parameters. If the service context you use contains them, then you can access them in calls like these:</p>
<pre><code>long userId = serviceContext.getUserId();
long groupId = serviceContext.getScopeGroupId();
</code></pre></div></div><p>Next, you&rsquo;ll learn what&rsquo;s needed to properly delete an entity that&rsquo;s associated with an asset. </p><a id="deleting-assets"></a><h2>Deleting Assets</h2><p>When deleting your entities, you should delete the associated assets and indexes at the same time. This cleans up stored asset and index information, which keeps the Asset Publisher from showing information for the entities you&rsquo;ve deleted.</p><p>In your <code>-LocalServiceImpl</code> Java class, open your <code>delete-</code> method. After the code that deletes the entity&rsquo;s resource, you must delete the entity instance&rsquo;s asset entry and index. </p><p>Here&rsquo;s some code which deletes an asset entry and an index associated with a portlet&rsquo;s entity. </p>
<pre><code>assetEntryLocalService.deleteEntry(
    ENTITY.class.getName(), ENTITY.getInsultId());

Indexer indexer = IndexerRegistryUtil.nullSafeGetIndexer(ENTITY.class);
indexer.delete(ENTITY);
</code></pre><p>In your <code>-LocalServiceImpl</code> class, you can write similar code. Replace the <em>ENTITY</em> class name and variable with your entity&rsquo;s name.</p><div class="sidebar"><div class="sidebar-image"></div><div class="sidebar-text"><p><strong>Important:</strong> In order for Liferay&rsquo;s Asset Publisher application to show your entity, the entity must have an Asset Renderer. <!-- To learn how to implement
an Asset Renderer for your custom entity, refer to Learning Path
[Implementing Asset Renderers](/develop/learning-paths/mvc/-/knowledge_base/6-2/implementing-asset-renderers).--> Note also that an Asset Renderer is how you show a user the components of your entity in the Asset Publisher. On deploying your portlet with asset, indexer, and asset rendering implementations in place, an Asset Publisher can show your custom entities!</p></div></div><p><img src="../../images/basic-asset-in-asset-publisher.png" alt="Figure 1" /><p class="caption">Figure 1: It can be useful to show custom entities, like this wiki page entity, in a JSP or in an Asset Publisher.</p><p>Great! Now you know how to add, update, and delete assets in your portlets!</p><a id="related-topics"></a><h2>Related Topics</h2><p><a href="/develop/tutorials/-/knowledge_base/7-0/relating-assets">Relating Assets</a></p><p><a href="/develop/tutorials/-/knowledge_base/7-0/what-is-service-builder">What is Service Builder?</a></p>
