# Using External Repositories [](id=using-external-repositories)

Content Management Interoperability Services (CMIS) is a specification for
improving interoperability between Enterprise Content Management systems.
Documents and Media allows users to connect to multiple third-party repositories
that support CMIS 1.0 with AtomPub and Web Services protocols.

Some of the features supported with third-party repositories include:

- Reading/writing documents and folders
- Document check-in, check-out, and undo check-out
- Downloading documents
- Moving folders and documents within the repository
- Getting revision history
- Reverting to revision

There are some subtle differences in setting up the different kinds of
third-party repositories for use in Documents and Media. But there are plenty of
similarities too.

Common Liferay configuration steps:

- Adjust the portal properties.
- Add any user accounts required by the repository.
- Add the repository.

Lastly, keep in mind your third-party repository may require installation and
deployment of an appropriate Liferay plugin. Plugins for SharePoint and
Documentum are available through Liferay's Marketplace.

Let's go through those steps, starting with setting our portal properties.

## Adjusting portal properties [](id=adjusting-portal-properties)

In order to authenticate with the third-party repository, you need to store
passwords for the user sessions. You must configure an authentication type that
supports storing passwords to the user sessions.

**Important**: Since authentication with single sign-on (SSO) does not store
encrypted passwords in the user sessions, SSO can't be used with the external
repository types. 

Let's configure Liferay Portal for what's required in authentication.
In your [Liferay Home](/discover/deployment/-/knowledge_base/6-2/liferay-home),
create a `portal-ext.properties` file, if one doesn't already exist, and add a [`session.store.password`](https://docs.liferay.com/portal/6.2/propertiesdoc/portal.properties.html#Session)
portal property set to `true`:

    session.store.password=true

Next, make sure to authenticate the same way on both Liferay Portal and
the external repository. You can do so by authenticating based on screen
name. Add the following [`company.security.auth.type`]( https://docs.liferay.com/portal/6.2/propertiesdoc/portal.properties.html#Company)
portal property to your `portal-ext.properties` file: 

    company.security.auth.type=screenName

Alternatively, configure these properties in the Control Panel under *Portal 
Settings* &rarr; *Authentication*.

## Adding required repository users [](id=adding-required-repository-users)

Once these properties are set, you must create a user in Liferay with a
screen name and password matching the administrative user of your external
repository. Be sure to assign appropriate roles (e.g. Administrator) to that
user. Sign out of Liferay and sign in again as that new user. See sections of
the *Management* chapter on adding and managing users.

## Adding the repository [](id=adding-the-repository)

You can add new repositories from the UI by clicking the *Add* button from the
Home folder. Repositories can only be mounted in the Home folder.

![Figure 5.5: You can add a new repository by navigating to *Add* &rarr; *Repository* in the Documents and Media portlet.](../../images/05-new-repository.png)

All fields in this form are required, except for *Repository ID*. Leave this
field blank, and a repository ID is automatically generated by the system. When
finished, the repository is displayed on the left side of the window in the Home
folder.

Using this information, we can now add an example repository. As noted
previously, there are several repositories that work well with Liferay using
CMIS. One that is familiar to many users is SharePoint. In the exercise below,
we'll set up SharePoint as a Documents and Media repository.

## Example Repository Setup: SharePoint [](id=example-repository-setup-sharepoint)

With Liferay Portal you can connect to an external SharePoint server and add it
as a Documents and Media repository. This lets users collaborate and
share documents more easily between both environments. We will mount a
SharePoint repository via CMIS AtomPub and SharePoint SOAP web services.

Liferay uses a combination of SOAP and Representational State Transfer (REST),
based on the Atom convention, to connect to the SharePoint repository.
SharePoint provides various SOAP services for modifying and querying data from
its document library. Liferay uses Axis2 to generate SOAP calls to the
SharePoint server.

Download and install the [SharePoint Connector EE](https://www.liferay.com/marketplace/-/mp/application/15188537)
hook from Marketplace. See the [Downloading and Installing Apps](/discover/portal/-/knowledge_base/6-2/downloading-and-installing-apps)
section of the *Leveraging the Liferay Marketplace* article for
more information.

To use SharePoint as a Liferay Documents and Media repository, we'll do the
following:

- Configure the CMIS Connector on SharePoint.
- Activate a SharePoint site as a CMIS Producer.
- Acquire your SharePoint document library's repository ID.
- Enable Basic Authentication on the SharePoint host.
- Add SharePoint as a Liferay Documents and Media repository.

Note that this section is geared towards portal system administrators and
SharePoint system administrators.

Before you can use SharePoint as an external repository with Liferay portal, you
must verify that SharePoint is properly configured. Several services must be
set up on the SharePoint server before synchronizing with Liferay.

### Configuring the CMIS Connector on SharePoint [](id=configuring-the-cmis-connector-on-sharepoint)

SharePoint utilizes a CMIS Connector and a CMIS Producer to interface with
Liferay Portal. If they're already installed on your SharePoint server, then you can
skip this section.

The CMIS Connector is installed with the SharePoint Administrator
Toolkit using a solution package called a Windows SharePoint file (.wsp). If you
don't have it already, install the SharePoint Administrator Toolkit for its CMIS
Connector. Install and deploy the CMIS Connector as a Farm Solution on
SharePoint.

The folder `Content Management Interoperability Services (CMIS) Connectors`
contains the `spscmis.wsp` file. Choose the appropriate deployment settings and
deploy that file. When deployment completes, Solution Properties shows the
solution is successfully deployed to all target sites. Now it's time to
activate the SharePoint site as a CMIS Producer.

### Activating a SharePoint site as a CMIS Producer [](id=activating-a-sharepoint-site-as-a-cmis-producer)

The Producer makes SharePoint repositories available through the CMIS Connector.
Choose the SharePoint site containing the document libraries to be used as
document repositories. Every document library in this site is made available as
a repository through the CMIS connector; but the site must first be activated as
a CMIS Producer. Let's activate it now.

Go to *Site Actions* &rarr; *Site Settings* &rarr; *Manage Site Features*.
Enable the *Content Management Interoperability Services (CMIS) Producer* by
clicking *Activate*.

Now any document library created under this SharePoint site is CMIS enabled.

Next, let's enable Basic Authentication on the SharePoint host.

### Enabling Basic Authentication on the SharePoint host [](id=enabling-basic-authentication-on-the-sharepoint-host)

So that Liferay's SharePoint Connector can authenticate against the SharePoint
web services, you must enable Basic Authentication on the SharePoint host. As
you do this, make sure to empty Basic Authentication's default domain and realm
fields of all values. We'll show you how to do this. 

Authentication setup steps differ between Windows versions. But as an
example, here are steps for enabling Basic Authentication on *Windows Server
2008*: 

1. Sign in to the Windows server as a member of the *Administrators* group. 
2. Open *Administrative Tools*, and then click *Internet Information Services
  (IIS) Manager* to launch the *IIS Manager* console. 
3. In the *Connections* navigation panel, navigate to the SharePoint web site
  options by clicking on the server's name, then *Sites*, and then the name of
  the SharePoint's site. The site's Features View is available in the main
  viewing area of the IIS Manager console.
4. Select *Features View* tab and then double-click on the *Authentication* icon
  in the *IIS* section of the Features View. The *Authentication* panel appears.
  ![Figure 1: The *Features View* for the site shows the *Authentication* icon.](../../images/sharepoint-site-iis-authentication.png)
5. In the *Authentication* panel, select the row named *Basic Authentication*.
  The *Actions* panel appears next to the main panel.
6. In the *Actions* panel, click *Enable* to activate Basic Authentication. 
7. Also in the *Actions* panel, click *Edit*. An *Edit Basic Authentication Settings*
  dialog box appears.
  ![Figure 2: Clicking the *Edit...* action brings up the a dialog for setting the *Default domain* and *Realm*.](../../images/sharepoint-host-edit-basic-auth-settings.png)
8. In the dialog box, empty the *Default domain* and *Realm* fields of any
  values and click *OK*.

You've configured Basic Authentication on the SharePoint host.

You are now prepared to mount SharePoint as an external repository.

### Adding SharePoint as a Liferay Documents and Media repository [](id=adding-sharepoint-as-a-liferay-documents-and-media-repository)

With the SharePoint server configured, we now turn our attention to back to
Liferay. As mentioned in the common steps for adding an external repository, be
sure to adjust the portal properties and add any user accounts required by the
repository.

Here are the steps for adding a SharePoint repository in the Documents and Media
Library: 

1. Add the Documents and Media application to a page, if you haven't done so
already.

2. From the home location in the Documents and Media application, click *Add*
and select *Repository*. The  *New Repository* screen appears. 

3. In the New Repository screen enter an arbitrary repository *Name* and a
*Description* (optional).

4. Click on the *Repository Configuration* section to access its form. Then
specify values for the following fields:

    - **Repository Type**: Select the SharePoint option.

    - **Site URL:** Enter the URL of the site where your SharePoint Library lives (e.g., `http://your-site`). 

    - **Library Name**: Enter a name for the library. Typically you'd 
    enter the name of the SharePoint Library you're connecting to.

5. After you've finished entering any additional options, click *Save*.

Your Documents and Media Library is now connected to the SharePoint repository.
The new external repository is now listed in the Documents and Media home. 

Now that you've added a SharePoint Repository to Documents and Media, you can
access and modify SharePoint Library files from within Liferay Portal's Documents and
Media Library.  

Now let's look at configuring the Documents and Media portlet.
